"""CSV file created using Matlab code. Want to alter the created CSV using this code

Create second sheet in CSV with following Headings: TMS (Y/N), TTL, Pulse Number, Timestamp, Time
Create third sheet in CSV with following Headings: TMS (Y/N), Pulse Number, Time

Need to figure out how to alter the time values in the CSV BEFORE running this code to alter the CSV
Need to figure out how to determine the time from the initial start value
Need to figure out how to add the created dataframes to the CSV as new sheets. Some code below"""

import csv
import pandas as pd
from datetime import datetime, timedelta

tmsFile='/Users/ashleypelton/Downloads/timing-rest-8blocks-60-101723 - Sheet1.csv'

sheet_name='Values'

TMSColumn = []
TTLCounter = []
TotalTTL = []
Blocks = []
TimeStamp = []
Time = []

pulse = 0

"""Iterates through the current CSV, pulling relevant data."""
with open(tmsFile, mode='r') as file:
    reader = csv.reader(file)
    for row in reader:
        for i in range(len(row)):
            if row[i] == 'Timestamp:':
                if i + 1 < len(row):
                    strTime = row[i+1]
                    timeFormat = "%H:%M:%S"
                    """Will need to add .%f later"""
                    numTime = datetime.strptime(strTime, timeFormat)
                    TimeStamp.append(numTime)
                    if len(TimeStamp) != 0:
                        Time.append((numTime - TimeStamp[0]).total_seconds())
                    else:
                        Time.append(numTime - numTime)
            elif row[i] == 'TTL:':
                if i + 1 < len(row):
                    TTLCounter.append(row[i + 1])
                    TotalTTL.append(pulse)
                    pulse += 1

            if row[i] == 'TMS:':
                if i + 1 < len(row):
                    TMSColumn.append('Y')
                    TTLCounter.append('P')
                    TotalTTL.append('P')
            else:
                TMSColumn.append('N')

print(TotalTTL)

"""Calculates the time from start for each timestamp.
initialTime = TimeStamp[0]
for t in TimeStamp:
    Time.append(t - initialTime)"""

"""Data to be added to Sheet 2 - 'All Values' """
data = { 'TMS (Y/N)' : [],
         'TTL Counter' : [],
         'Total TTL' : [],
         'Blocks' : [],
         'Timestamp' : [],
         'Time/Duration (Seconds)' : []}
df = pd.DataFrame(data)

"""Need to figure out how to add these data frames to different sheets!"""
"""with pd.ExcelWriter(tmsFile, engine='openpyxl', mode='a') as writer:
    df.to_excel(writer, sheet_name='All Values', index=False)

with pd.ExcelWriter(tmsFile, engine='openpyxl', mode='a') as writer:
    updatedDf.to_excel(writer, sheet_name='Relevant Values', index=False)"""